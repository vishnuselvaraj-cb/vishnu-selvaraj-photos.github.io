<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vishnu Selvaraj</title>
    <meta name="description" content="Photography" />
    <meta name="color-scheme" content="light" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;1,300;1,400&family=Inter:wght@300;400;500&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg: #ffffff;
        --fg: rgba(10, 10, 10, 0.92);
        --ink: rgba(10, 10, 10, 0.92);
        --ui: rgba(10, 10, 10, 0.14);
        --ui2: rgba(10, 10, 10, 0.28);
        --ease: cubic-bezier(0.2, 0.8, 0.2, 1);
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        overflow-x: hidden;
        overflow-y: auto;
      }

      /* subtle grain */
      body::after {
        content: '';
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 10;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='280' height='280'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='280' height='280' filter='url(%23n)' opacity='0.07'/%3E%3C/svg%3E");
        background-size: 280px 280px;
        mix-blend-mode: multiply;
        opacity: 0.25;
      }

      .stage {
        position: relative;
        width: 100%;
        height: 100svh;
        isolation: isolate;
        background: var(--bg);
        overflow: hidden;
        z-index: 1;
      }

      .gallery {
        padding: 18px 18px 48px;
        background: var(--bg);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 10px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .thumb {
        appearance: none;
        border: 1px solid rgba(10, 10, 10, 0.12);
        background: transparent;
        padding: 0;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
      }

      .thumb:focus-visible {
        outline: 2px solid rgba(10, 10, 10, 0.25);
        outline-offset: 4px;
      }

      .thumb-inner {
        aspect-ratio: 1 / 1;
        width: 100%;
        position: relative;
      }

      .thumb img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        opacity: 0.92;
        transition: opacity 220ms ease;
      }

      .thumb:hover img {
        opacity: 1;
      }

      .slide {
        position: absolute;
        inset: 0;
        z-index: 1;
        overflow: hidden;
        opacity: 0;
        transform: scale(1.02);
        transition:
          opacity 620ms var(--ease),
          transform 900ms var(--ease);
      }

      .slide.is-active {
        opacity: 1;
        transform: scale(1);
      }

      .slide img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
        user-select: none;
        -webkit-user-drag: none;
        filter: saturate(0.98) contrast(1.02);
        transform: translateZ(0);
        transition: transform 900ms var(--ease);
        will-change: transform;
      }

      /* Image art direction
         - Portrait: crop top/bottom (cover)
         - Landscape: slightly larger (subtle scale)
      */
      .slide img.is-portrait {
        inset: auto;
        left: 50%;
        top: 50%;
        width: min(54vw, 560px);
        height: min(74vh, 760px);
        max-width: calc(100vw - 84px);
        max-height: calc(100vh - 84px);
        object-fit: cover;
        object-position: 50% 50%;
        transform: translate(-50%, -50%);
      }

      @media (max-width: 740px) {
        .slide img.is-portrait {
          width: min(86vw, 420px);
          height: min(72vh, 620px);
          max-width: calc(100vw - 32px);
          max-height: calc(100vh - 32px);
        }
      }

      .slide img.is-landscape {
        transform: scale(1.06);
      }

      /* click zones */
      .zone {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 40%;
        z-index: 5;
        cursor: none;
      }
      .zone.prev {
        left: 0;
      }
      .zone.next {
        right: 0;
      }

      /* custom cursor */
      .cursor {
        position: fixed;
        pointer-events: none;
        z-index: 9999;
        width: 32px;
        height: 32px;
        transform: translate(-50%, -50%);
        opacity: 0;
        transition: opacity 180ms ease;
      }

      .cursor.is-visible {
        opacity: 1;
      }

      .cursor::before {
        content: '';
        display: block;
        width: 100%;
        height: 100%;
        background: rgba(10, 10, 10, 0.6);
        mask-size: contain;
        mask-position: center;
        mask-repeat: no-repeat;
        -webkit-mask-size: contain;
        -webkit-mask-position: center;
        -webkit-mask-repeat: no-repeat;
      }

      .cursor.cursor-prev::before {
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' stroke-width='1'%3E%3Cpath fill='none' stroke='black' stroke-width='1.5' d='M15 5l-7 7 7 7'/%3E%3C/svg%3E");
        -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' stroke-width='1'%3E%3Cpath fill='none' stroke='black' stroke-width='1.5' d='M15 5l-7 7 7 7'/%3E%3C/svg%3E");
      }

      .cursor.cursor-next::before {
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' stroke-width='1'%3E%3Cpath fill='none' stroke='black' stroke-width='1.5' d='M9 5l7 7-7 7'/%3E%3C/svg%3E");
        -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' stroke-width='1'%3E%3Cpath fill='none' stroke='black' stroke-width='1.5' d='M9 5l7 7-7 7'/%3E%3C/svg%3E");
      }

      /* UI */
      .ui {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 8;
      }

      .ui.is-idle .nav,
      .ui.is-idle .dots {
        opacity: 0;
        pointer-events: none;
      }

      .hamburger {
        position: fixed;
        top: 18px;
        left: 18px;
        z-index: 1200;
        width: 44px;
        height: 44px;
        border: 1px solid var(--ui);
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        pointer-events: auto;
        display: grid;
        place-items: center;
        transition:
          border-color 240ms ease,
          background 240ms ease,
          opacity 240ms ease;
        opacity: 0.9;
      }

      .hamburger:hover {
        border-color: var(--ui2);
        background: rgba(255, 255, 255, 0.82);
        opacity: 1;
      }

      .hamburger-lines {
        width: 18px;
        height: 12px;
        display: grid;
        align-content: space-between;
      }

      .hamburger-lines span {
        display: block;
        height: 1.5px;
        background: rgba(10, 10, 10, 0.78);
        border-radius: 999px;
        transform-origin: center;
        transition:
          transform 260ms var(--ease),
          opacity 200ms ease;
      }

      .hamburger.open .hamburger-lines span:nth-child(1) {
        transform: translateY(5px) rotate(45deg);
      }

      .hamburger.open .hamburger-lines span:nth-child(2) {
        opacity: 0;
      }

      .hamburger.open .hamburger-lines span:nth-child(3) {
        transform: translateY(-5px) rotate(-45deg);
      }

      /* MENU OVERLAY (as requested) */
      .menu {
        position: fixed;
        inset: 0;
        z-index: 1100;
        background: var(--bg);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.45s var(--ease);
      }

      .menu.open {
        opacity: 1;
        pointer-events: all;
      }

      .menu-inner {
        width: min(880px, calc(100vw - 64px));
        text-align: center;
      }

      .menu-name {
        font-family: 'Cormorant Garamond', Georgia, serif;
        font-size: clamp(3rem, 8vw, 6rem);
        font-weight: 300;
        font-style: italic;
        color: var(--ink);
        opacity: 0;
        transform: translateY(12px);
        transition:
          opacity 0.5s var(--ease) 0.1s,
          transform 0.5s var(--ease) 0.1s;
      }

      .menu-rule {
        width: min(620px, 70vw);
        height: 1px;
        margin: 22px auto 18px;
        background: rgba(10, 10, 10, 0.14);
        opacity: 0;
        transition: opacity 0.5s var(--ease) 0.2s;
      }

      .menu-links {
        display: grid;
        gap: 10px;
        justify-items: center;
        opacity: 0;
        transform: translateY(10px);
        transition:
          opacity 0.5s var(--ease) 0.25s,
          transform 0.5s var(--ease) 0.25s;
      }

      .menu-email-bottom {
        position: fixed;
        left: 50%;
        bottom: 56px;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.5s var(--ease) 0.28s;
      }

      .menu.open .menu-email-bottom {
        opacity: 1;
      }

      .menu-link {
        font-size: 0.78rem;
        font-weight: 400;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(10, 10, 10, 0.74);
        text-decoration: none;
      }

      a.menu-link:hover {
        color: rgba(10, 10, 10, 0.92);
      }

      .menu-copy {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        font-size: 0.72rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(10, 10, 10, 0.5);
        opacity: 0;
        transition: opacity 0.5s var(--ease) 0.28s;
        pointer-events: none;
        user-select: none;
      }

      .menu.open .menu-name {
        opacity: 1;
        transform: translateY(0);
      }

      .menu.open .menu-rule {
        opacity: 1;
      }

      .menu.open .menu-links {
        opacity: 1;
        transform: translateY(0);
      }

      .menu.open .menu-copy {
        opacity: 1;
      }

      .nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 44px;
        height: 44px;
        border: 1px solid var(--ui);
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        pointer-events: auto;
        display: grid;
        place-items: center;
        transition:
          border-color 240ms ease,
          background 240ms ease,
          transform 240ms var(--ease),
          opacity 240ms ease;
        opacity: 0.86;
      }

      .nav:hover {
        border-color: var(--ui2);
        background: rgba(255, 255, 255, 0.82);
        opacity: 1;
      }

      .nav:active {
        transform: translateY(-50%) scale(0.98);
      }

      .nav.prev {
        left: 18px;
      }
      .nav.next {
        right: 18px;
      }

      .nav::before {
        content: '';
        width: 18px;
        height: 18px;
        background: rgba(10, 10, 10, 0.78);
        mask-size: contain;
        mask-position: center;
        mask-repeat: no-repeat;
        -webkit-mask-size: contain;
        -webkit-mask-position: center;
        -webkit-mask-repeat: no-repeat;
      }

      .nav.prev::before {
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M15.5 4.5 8 12l7.5 7.5-1.4 1.4L5.2 12l8.9-8.9z'/%3E%3C/svg%3E");
        -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M15.5 4.5 8 12l7.5 7.5-1.4 1.4L5.2 12l8.9-8.9z'/%3E%3C/svg%3E");
      }

      .nav.next::before {
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M8.5 19.5 16 12 8.5 4.5l1.4-1.4L18.8 12l-8.9 8.9z'/%3E%3C/svg%3E");
        -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M8.5 19.5 16 12 8.5 4.5l1.4-1.4L18.8 12l-8.9 8.9z'/%3E%3C/svg%3E");
      }

      .dots {
        position: absolute;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        pointer-events: auto;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid rgba(10, 10, 10, 0.12);
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        opacity: 0.9;
        transition: opacity 240ms ease;
      }

      .dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        border: 1px solid rgba(10, 10, 10, 0.24);
        background: transparent;
        padding: 0;
        cursor: pointer;
        opacity: 0.8;
      }

      .dot.is-active {
        background: rgba(10, 10, 10, 0.72);
        border-color: rgba(10, 10, 10, 0.72);
        opacity: 1;
      }

      .dot:focus-visible,
      .nav:focus-visible {
        outline: 2px solid rgba(10, 10, 10, 0.25);
        outline-offset: 4px;
      }

      .hamburger:focus-visible {
        outline: 2px solid rgba(10, 10, 10, 0.25);
        outline-offset: 4px;
      }

      @media (max-width: 740px) {
        .nav.prev {
          left: 10px;
        }
        .nav.next {
          right: 10px;
        }
        .zone {
          width: 46%;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .slide {
          transition: opacity 180ms linear;
          transform: none;
        }
        .slide.is-active {
          transform: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="cursor" id="cursor" aria-hidden="true"></div>

    <button class="hamburger" id="hamburger" type="button" aria-label="Menu">
      <span class="hamburger-lines" aria-hidden="true">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </button>

    <main class="stage" id="stage" aria-label="Photo viewer">
      <div class="zone prev" id="zonePrev" aria-hidden="true"></div>
      <div class="zone next" id="zoneNext" aria-hidden="true"></div>

      <div class="ui" id="ui" aria-hidden="false">
        <div class="dots" id="dots" aria-label="Slide navigation"></div>
      </div>
    </main>

    <section class="gallery" aria-label="Gallery">
      <div class="grid" id="grid"></div>
    </section>

    <div class="menu" id="menu" role="dialog" aria-modal="true" aria-label="Navigation">
      <div class="menu-inner">
        <div class="menu-name">Vishnu Selvaraj</div>
        <div class="menu-rule"></div>
        <div class="menu-links">
          <span class="menu-link" style="color: var(--ink); letter-spacing: 0.35em; font-size: 0.58rem">Photography</span>
        </div>
      </div>
      <a href="mailto:vishnu.selvaraj@gmail.com" class="menu-link menu-email-bottom">vishnu.selvaraj@gmail.com</a>
      <div class="menu-copy">&#169; 2026 Vishnu Selvaraj</div>
    </div>

    <script>
      // ================================================================
      //  PHOTOS SOURCE
      //  Edit `photos.json` to add/remove/reorder photos.
      // ================================================================
      let photos = [];

      const stageEl = document.getElementById('stage');
      const uiEl = document.getElementById('ui');
      const dotsEl = document.getElementById('dots');
      const gridEl = document.getElementById('grid');
      const zonePrevEl = document.getElementById('zonePrev');
      const zoneNextEl = document.getElementById('zoneNext');
      const hamburger = document.getElementById('hamburger');
      const menu = document.getElementById('menu');
      const cursorEl = document.getElementById('cursor');

      let index = 0;
      let isLocked = false;
      let wheelCooldownId = 0;
      let idleTimerId = 0;
      let cursorMode = null; // 'prev' | 'next' | null

      const AUTO_ADVANCE_MS = 4000;
      let autoAdvanceId = 0;
      let slides = [];
      let dots = [];

      let isMenuOpen = false;

      // Custom cursor logic
      function updateCursor(x, y) {
        cursorEl.style.left = x + 'px';
        cursorEl.style.top = y + 'px';
      }

      function showCursor(mode) {
        if (isMenuOpen) return;
        cursorMode = mode;
        cursorEl.classList.remove('cursor-prev', 'cursor-next');
        if (mode) {
          cursorEl.classList.add('cursor-' + mode);
          cursorEl.classList.add('is-visible');
        }
      }

      function hideCursor() {
        cursorMode = null;
        cursorEl.classList.remove('is-visible');
      }

      zonePrevEl.addEventListener('mouseenter', () => showCursor('prev'));
      zoneNextEl.addEventListener('mouseenter', () => showCursor('next'));
      zonePrevEl.addEventListener('mouseleave', hideCursor);
      zoneNextEl.addEventListener('mouseleave', hideCursor);

      zonePrevEl.addEventListener('mousemove', (e) => updateCursor(e.clientX, e.clientY));
      zoneNextEl.addEventListener('mousemove', (e) => updateCursor(e.clientX, e.clientY));

      function setChromeTabbable(enabled) {
        const tabIndex = enabled ? null : '-1';

        if (tabIndex === null) {
          dots.forEach((d) => d.removeAttribute('tabindex'));
          return;
        }

        dots.forEach((d) => d.setAttribute('tabindex', tabIndex));
      }

      function showChrome() {
        uiEl.classList.remove('is-idle');
        setChromeTabbable(true);
        scheduleIdle();
      }

      function hideChrome() {
        if (isMenuOpen) return;
        uiEl.classList.add('is-idle');
        setChromeTabbable(false);
      }

      function scheduleIdle() {
        window.clearTimeout(idleTimerId);
        if (isMenuOpen) return;
        idleTimerId = window.setTimeout(() => hideChrome(), 1600);
      }

      function stopAutoAdvance() {
        window.clearInterval(autoAdvanceId);
        autoAdvanceId = 0;
      }

      function startAutoAdvance() {
        if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        stopAutoAdvance();
        autoAdvanceId = window.setInterval(() => {
          if (document.hidden) return;
          if (isMenuOpen) return;
          if (isLocked) return;
          goTo(index + 1, true);
        }, AUTO_ADVANCE_MS);
      }

      function bumpAutoAdvance() {
        if (!autoAdvanceId) return;
        startAutoAdvance();
      }

      function openMenu() {
        menu.classList.add('open');
        hamburger.classList.add('open');
        isMenuOpen = true;
        stopAutoAdvance();
      }

      function closeMenu() {
        menu.classList.remove('open');
        hamburger.classList.remove('open');
        isMenuOpen = false;
        startAutoAdvance();
      }

      hamburger.addEventListener('click', () => {
        menu.classList.contains('open') ? closeMenu() : openMenu();
      });

      function clearGallery() {
        slides.forEach((s) => s.remove());
        slides = [];

        dotsEl.textContent = '';
        dots = [];
      }

      function buildGallery() {
        clearGallery();

        slides = photos.map((p, i) => {
          const slide = document.createElement('div');
          slide.className = 'slide' + (i === 0 ? ' is-active' : '');

          const img = document.createElement('img');
          img.src = p.src;
          img.alt = '';
          img.decoding = 'async';
          img.loading = i === 0 ? 'eager' : 'lazy';
          img.draggable = false;

          function applyOrientation() {
            const w = img.naturalWidth || 0;
            const h = img.naturalHeight || 0;
            if (!w || !h) return;
            img.classList.remove('is-portrait', 'is-landscape');
            if (h > w) img.classList.add('is-portrait');
            else img.classList.add('is-landscape');
          }

          img.addEventListener('load', applyOrientation);
          if (img.complete) applyOrientation();

          slide.appendChild(img);
          stageEl.appendChild(slide);
          return slide;
        });

        dots = photos.map((_, i) => {
          const b = document.createElement('button');
          b.type = 'button';
          b.className = 'dot' + (i === 0 ? ' is-active' : '');
          b.setAttribute('aria-label', `Go to ${i + 1}`);
          b.addEventListener('click', () => goTo(i, false));
          dotsEl.appendChild(b);
          return b;
        });

        // Thumbnails grid
        gridEl.textContent = '';
        photos.forEach((p, i) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'thumb';
          btn.setAttribute('aria-label', `View photo ${i + 1}`);

          const inner = document.createElement('div');
          inner.className = 'thumb-inner';

          const img = document.createElement('img');
          img.src = p.src;
          img.alt = '';
          img.loading = 'lazy';
          img.decoding = 'async';
          img.draggable = false;

          inner.appendChild(img);
          btn.appendChild(inner);
          btn.addEventListener('click', () => {
            closeMenu();
            goTo(i, false);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showChrome();
          });

          gridEl.appendChild(btn);
        });
      }

      function warmCache(i) {
        if (!photos.length) return;
        const next = photos[(i + 1) % photos.length]?.src;
        const prev = photos[(i - 1 + photos.length) % photos.length]?.src;
        [next, prev]
          .filter(Boolean)
          .forEach((src) => {
            const im = new Image();
            im.decoding = 'async';
            im.src = src;
          });
      }

      function setHash(i) {
        const v = String(i + 1);
        if (location.hash !== '#' + v) history.replaceState(null, '', '#' + v);
      }

      function activate(i) {
        if (!photos.length) return;
        slides[index]?.classList.remove('is-active');
        dots[index]?.classList.remove('is-active');

        index = i;
        slides[index]?.classList.add('is-active');
        dots[index]?.classList.add('is-active');

        setHash(index);
        warmCache(index);
      }

      function goTo(i, isAuto) {
        if (!photos.length) return;
        if (isLocked || i === index) return;
        isLocked = true;
        activate((i + photos.length) % photos.length);
        window.clearTimeout(wheelCooldownId);
        wheelCooldownId = window.setTimeout(() => {
          isLocked = false;
        }, 520);

        if (!isAuto) bumpAutoAdvance();
      }

      function next() {
        goTo(index + 1, false);
      }

      function prev() {
        goTo(index - 1, false);
      }

      zonePrevEl.addEventListener('click', prev);
      zoneNextEl.addEventListener('click', next);

      dotsEl.addEventListener('mouseenter', showChrome);
      hamburger.addEventListener('mouseenter', showChrome);

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMenu();
        if (e.key === 'ArrowRight' || e.key === 'PageDown') next();
        if (e.key === 'ArrowLeft' || e.key === 'PageUp') prev();
        showChrome();
        bumpAutoAdvance();
      });

      // Note: no wheel-to-navigate here so the page can scroll naturally to the grid.

      let tx0 = 0,
        ty0 = 0;
      window.addEventListener(
        'touchstart',
        (e) => {
          if (!e.touches?.[0]) return;
          tx0 = e.touches[0].clientX;
          ty0 = e.touches[0].clientY;
          showChrome();
          bumpAutoAdvance();
        },
        { passive: true }
      );
      window.addEventListener(
        'touchend',
        (e) => {
          if (!e.changedTouches?.[0]) return;
          const dx = tx0 - e.changedTouches[0].clientX;
          const dy = Math.abs(ty0 - e.changedTouches[0].clientY);
          if (Math.abs(dx) > 44 && dy < 90) dx > 0 ? next() : prev();
          showChrome();
          bumpAutoAdvance();
        },
        { passive: true }
      );

      document.addEventListener('mousemove', showChrome, { passive: true });
      document.addEventListener('focusin', showChrome);

      document.addEventListener('visibilitychange', () => {
        if (document.hidden) stopAutoAdvance();
        else startAutoAdvance();
      });

      async function loadPhotos() {
        const res = await fetch('photos.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('Failed to load photos.json');
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error('photos.json must be an array');

        photos = data
          .map((p) => {
            if (typeof p === 'string') return { src: p };
            if (p && typeof p.src === 'string') return { src: p.src };
            return null;
          })
          .filter(Boolean);

        if (!photos.length) throw new Error('No photos found in photos.json');
      }

      (async function init() {
        try {
          await loadPhotos();
          buildGallery();

          const n = Number(String(location.hash || '').replace('#', ''));
          if (Number.isFinite(n) && n >= 1 && n <= photos.length) {
            activate(n - 1);
          } else {
            setHash(index);
            warmCache(index);
          }

          // Start with visible UI, then gently fade to idle.
          setChromeTabbable(true);
          scheduleIdle();
          startAutoAdvance();
        } catch (err) {
          // Fail silently but keep page functional
          console.error(err);
        }
      })();
    </script>
  </body>
</html>
